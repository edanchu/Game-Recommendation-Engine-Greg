import csv
import requests
import json
import pickle
import numpy as np
import pandas as pd

def main():
    infile = open("Data\\UsersDict.pkl", "rb")
    users = pickle.load(infile)
    infile.close()

    # infile = open("Data\\GameFeatureMatrix.pkl")
    gameFeatureMatrixDF = pd.read_pickle("Data\\GameFeatureMatrix.pkl")
    # infile.close()
    gameLocDict = {}
    for i, game in enumerate(gameFeatureMatrixDF.index):
        gameLocDict[game] = i

    userLocs = {}
    i = 0
    for user, status in users.items():
        if status != "Private":
            userLocs[user] = i
            i += 1

    userInteractions = np.zeros((len(userLocs), len(gameLocDict)))

    for user, loc in userLocs.items():
        for game in users[user]:
            if (game not in gameLocDict): 
                continue
            userInteractions[loc][gameLocDict[game]] = 1

    userInteractionsDF = pd.DataFrame(data=userInteractions, columns = list(gameLocDict.keys()), index = list(userLocs.keys()))
    print("writing")
    # userInteractionsDF.to_csv("Data\\userInteractions.csv", sep=",")
    outfile = open("Data\\userInteractions.pkl", "wb")
    pickle.dump(userInteractionsDF, outfile)
    outfile.close()

if __name__ == "__main__":
    main()